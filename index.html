<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <title>Quadro Kanban</title>
    <link rel="stylesheet" type="text/css" href="css/estilos.css">
    <link rel="icon"
        href="data:image/png;base64,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"
        type="image/x-icon">
</head>

<body>
    <header>
        <h1> Kanban</h1>
    </header>
    <div class="sidebar">
        <button id="add-task-btn" class="add-task-btn">Adicionar Tarefa</button>
    </div>

    <section id="kanban-board">
        <div class="kanban-column" id="todo">
            <h2>To do</h2>
            <div class="tasks-container"></div>
        </div>

        <div class="kanban-column" id="inProgress">
            <h2>In Progress</h2>
            <div class="tasks-container"></div>
        </div>

        <div class="kanban-column" id="completed">
            <h2>Completed</h2>
            <div class="tasks-container"></div>
        </div>
    </section>

    <!-- Modal/Formulário para Adicionar/Editar Tarefas -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Adicionar/Editar Tarefa</h2>
            <form id="task-form">
                <input type="text" id="task-title" placeholder="Título da Tarefa" required>
                <textarea id="task-desc" placeholder="Descrição da Tarefa"></textarea>
                <input type="date" id="task-start-date" placeholder="Data de Início">
                <input type="date" id="task-end-date" placeholder="Data de Conclusão">
                <input type="text" id="task-responsible" placeholder="Responsável pela Tarefa">
                <input type="hidden" id="task-id"> <!-- Para edição de tarefa -->
                <button type="submit">Salvar Tarefa</button>
                <button type="button" id="cancel-task-btn">Cancelar</button>
            </form>
        </div>
    </div>
    <footer>
        <p>&copy; 2023 Ferreira,Adenilton</p>
    </footer>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const sidebar = document.querySelector('.sidebar');
            const addTaskBtn = document.getElementById("add-task-btn");
            const taskModal = document.getElementById("task-modal");
            const closeBtn = document.querySelector(".close-button");
            const taskForm = document.getElementById("task-form");
            const kanbanColumns = document.querySelectorAll(".kanban-column");
            const cancelTaskBtn = document.getElementById("cancel-task-btn");
            cancelTaskBtn.addEventListener("click", function () {
                taskModal.style.display = "none";
            });

            window.addEventListener("click", function (event) {
                if (event.target === taskModal) {
                    taskModal.style.display = "none";
                }
            });

            function generateId() {
                return Date.now().toString();
            }

            function loadTasks() {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('task_')) {
                        const task = JSON.parse(localStorage.getItem(key));
                        createTaskElement(task, key.split('_')[1]);
                    }
                }
            }

            function createTaskElement(task, id) {
                const taskContainer = document.getElementById(task.status).querySelector('.tasks-container');
                const newTask = document.createElement('div');
                newTask.className = 'task';
                newTask.setAttribute('draggable', 'true');
                newTask.setAttribute('data-task-id', id);
                newTask.style.backgroundColor = getColorByStatus(task.status);

                newTask.innerHTML = `
    <h3 class="task-title">${task.title}</h3>
    <p class="task-desc">${task.description}</p>
    <p class="task-dates">Início: ${task.startDate || 'Não definido'} - Fim: ${task.endDate || 'Não definido'}</p>
    <p class="task-responsible">Responsável: ${task.responsible || 'Não definido'}</p>
`;

                const editButton = document.createElement('button');
                editButton.textContent = 'Editar';
                editButton.onclick = function () { openEditTask(id); };
                newTask.appendChild(editButton);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Excluir';
                deleteButton.onclick = function () { confirmDeleteTask(id); };
                newTask.appendChild(deleteButton);

                taskContainer.appendChild(newTask);
                addDragEvents(newTask);
            }

            function addDragEvents(taskElement) {
                taskElement.addEventListener('dragstart', function (e) {
                    e.dataTransfer.setData('text/plain', e.target.getAttribute('data-task-id'));
                });
            }

            function getColorByStatus(status) {
                const colors = {
                    todo: '#ffcc00',
                    inProgress: '#add8e6',
                    completed: '#5cb85c'
                };
                return colors[status] || colors.todo;
            }

            function openEditTask(id) {
                const task = JSON.parse(localStorage.getItem('task_' + id));
                document.getElementById("task-id").value = id;
                document.getElementById("task-title").value = task.title;
                document.getElementById("task-desc").value = task.description;
                document.getElementById("task-start-date").value = task.startDate;
                document.getElementById("task-end-date").value = task.endDate;
                document.getElementById("task-responsible").value = task.responsible;
                taskModal.style.display = "flex";
            }

            function confirmDeleteTask(id) {
                if (confirm('Tem certeza que deseja excluir esta tarefa?')) {
                    deleteTask(id);
                }
            }

            function deleteTask(id) {
                localStorage.removeItem('task_' + id);
                const taskElement = document.querySelector(`[data-task-id="${id}"]`);
                taskElement.remove();
            }

            kanbanColumns.forEach(column => {
                column.addEventListener('dragover', function (e) {
                    e.preventDefault();
                });

                column.addEventListener('drop', function (e) {
                    e.preventDefault();
                    const taskId = e.dataTransfer.getData('text/plain');
                    const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
                    const status = column.id;
                    taskElement.style.backgroundColor = getColorByStatus(status);
                    column.querySelector('.tasks-container').appendChild(taskElement);

                    const task = JSON.parse(localStorage.getItem('task_' + taskId));
                    task.status = status;
                    localStorage.setItem('task_' + taskId, JSON.stringify(task));
                });
            });

            addTaskBtn.addEventListener("click", function () {
                taskModal.style.display = "flex";
                taskForm.reset();
                document.getElementById("task-id").value = generateId();
            });

            closeBtn.addEventListener("click", function () {
                taskModal.style.display = "none";
            });

            taskForm.addEventListener("submit", function (event) {
                event.preventDefault();
                const taskTitle = document.getElementById("task-title").value;
                const taskDesc = document.getElementById("task-desc").value;
                const taskStartDate = document.getElementById("task-start-date").value;
                const taskEndDate = document.getElementById("task-end-date").value;
                const taskResponsible = document.getElementById("task-responsible").value;
                const taskId = document.getElementById("task-id").value;

                const task = {
                    title: taskTitle,
                    description: taskDesc,
                    startDate: taskStartDate,
                    endDate: taskEndDate,
                    responsible: taskResponsible,
                    status: 'todo'
                };

                if (localStorage.getItem('task_' + taskId)) {
                    task.status = JSON.parse(localStorage.getItem('task_' + taskId)).status;
                } else {
                    task.id = generateId();
                }

                localStorage.setItem('task_' + taskId, JSON.stringify(task));
                createTaskElement(task, taskId);
                taskModal.style.display = "none";
                loadTasks();
            });

            // Evento de clique na sidebar para alternar a visibilidade
            sidebar.addEventListener('click', function (event) {
                // Verifica se o clique foi diretamente na sidebar e não nos elementos internos
                if (event.target === sidebar) {
                    sidebar.classList.toggle('sidebar-hidden');
                }
            });

            // Carregar as tarefas quando a página for carregada
            loadTasks();
        });
    </script>
</body>

</html>